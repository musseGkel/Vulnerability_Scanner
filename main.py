
import json
from apacheVolnerabilityLookup import lookup_vulnerabilities
from getRunningServiceVersion import  get_running_service_version
# from generateReport import generate_pdf
from handleInput import parse_input_file, validate_service_data

# services = parse_input_file('input.json')
# if services:
#     print("Successfully parsed and validated the input data:")
#     print(json.dumps(services, indent=2))
# else:
#     print("Failed to parse the input data.")

####################################################################################################

services = [
    {
        "ip": "172.17.0.3",
        "port": 80,
        "base_url": "http://192.168.1.1/",
        "service_type": "Apache"
    },
    {
        "ip": "192.168.1.2",
        "port": 3306,
        "base_url": "http://192.168.1.1/",
        "service_type": "MySQL"
    },
    {
        "ip": "192.168.0.4",
        "port": 80,
        "base_url": "http://192.168.0.4",
        "service_type": "WordPress",
    },
    {
        "ip": "192.168.1.3",
        "port": 80,
        "base_url": "http://192.168.1.1/",
        "service_type": "WordPress"
    }
]

for service in services:
    container_name = f"my-{service['service_type'].lower()}"
    version = get_running_service_version(container_name, service['service_type'])
    print(f"{service['service_type']} version: {version}")

# running_service_version = get_container_running_service_version('my-apache')
# if running_service_version:
#     print(f"Apache version: {running_service_version}")
# else:
#     print("Failed to retrieve Apache version.")

####################################################################################################
# # Example usage:
# # service_type = "Apache"
# # service_version = "1.4.59"
# service_type = "openssl"
# service_version = "1.1.1h"
# # service_type = "wordpress"
# # service_version = "116.5.2"
# vulnerabilities = lookup_vulnerabilities(service_type, service_version)
# if vulnerabilities:
#     for vuln in vulnerabilities:
#             print("=====================================================")
#             print("CVE ID:", vuln['id'])
#             print("Summary:", vuln['summary'])
#             print("CVSS Score:", vuln['cvss_score'])
#             print("Severity:", vuln['severity'])
#             print("Published Date:", vuln['published_date'])
#             # print("References:", vuln['references'])
#             print("Access Vector:", vuln['access_vector'])
#             print("Authentication:", vuln['authentication'])
#             print("Availability Impact:", vuln['availability_impact'])
#             print("Confidentiality Impact:", vuln['confidentiality_impact'])
#             print("Integrity Impact:", vuln['integrity_impact'])
#             print("=====================================================")
#             print()
            
#             generate_pdf(vulnerabilities, service_type, service_version)
# else:
#      print("No vulnerabilities found for the specified version.")
