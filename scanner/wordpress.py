import re
import requests
import os
from bs4 import BeautifulSoup


def extract_wordpress_version(version_string):
    # Extract version number from WordPress version string
    match = re.search(r'(\d+\.\d+(\.\d+)?)', version_string)
    if match:
        return match.group(1)
    return None
def get_wordpress_version(service):
    # Extract WordPress version from the HTML content
    url = service['base_url'] if 'base_url' in service else f"http://{service['ip']}:{service['port']}/"
    try:
        response = requests.get(url)
        if response.status_code == 200:
            soup = BeautifulSoup(response.content, 'html.parser')
            # Assuming version information is contained in a meta tag with name="generator"
            version_tag = soup.find('meta', attrs={'name': 'generator'})
            if version_tag:
                version = version_tag.get('content')
                return extract_wordpress_version(version)
            else:
                print("Failed to find version information in HTML.")
                return None
        else:
            print(f"Failed to retrieve WordPress homepage. Status code: {response.status_code}")
            return None
    except requests.RequestException as e:
        print(f"An error occurred while retrieving WordPress homepage: Failed to establish a connection.")
        return None

