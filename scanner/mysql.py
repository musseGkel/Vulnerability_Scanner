import re
import mysql.connector
import os

def extract_mysql_version(version_string):
    # Extract version number from MySQL version string
    match = re.search(r'([\d.]+)', version_string)
    if match:
        return match.group(1)
    return None


def get_mysql_version(service):
    # Retrieve MySQL root password from environment variable
    root_password = os.environ.get('MYSQL_ROOT_PASSWORD')

    # Connect to MySQL database
    try:
        connection = mysql.connector.connect(
            host=service['ip'],
            port=service['port'],
            user='root',
            password=root_password
        )
        cursor = connection.cursor()
        cursor.execute("SELECT VERSION()")
        mysql_version = cursor.fetchone()[0]
        cursor.close()
        connection.close()
        return extract_mysql_version(mysql_version)
    except mysql.connector.Error as err:
        print("MySQL connection error:", " Failed to establish a connection.")
        return None



