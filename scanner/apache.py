import re
import requests

def extract_apache_version(server_header):
    # Extract version number from Apache server header
    match = re.search(r'Apache\/([\d.]+)', server_header)
    if match:
        return match.group(1)
    return None

def get_apache_version(service):
    # Extract Apache version from the response headers
    url = service['base_url'] if 'base_url' in service else f"http://{service['ip']}:{service['port']}/"
    try:
        response = requests.get(url)
        if response.status_code == 200:
            apache_version = response.headers.get('Server')
            return extract_apache_version(apache_version)
        else:
            print(f"Failed to retrieve Apache homepage. Status code: {response.status_code}")
            return None
    except requests.RequestException as e:
        print(f"An error occurred while retrieving Apache homepage: Failed to establish a connection.")
        return None
